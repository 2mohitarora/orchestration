nomad job run -address=http://198.19.249.89:4646 -region=east redis.hcl

//Run this from both regions
dig @127.0.0.1 -p 8600 redis-svc.service.consul
dig @127.0.0.1 -p 8600 redis-svc.service.east.consul


nomad job run -address=http://198.19.249.89:4646 -region=west redis.hcl

//Run this from both regions
dig @127.0.0.1 -p 8600 redis-svc.service.consul
dig @127.0.0.1 -p 8600 redis-svc.service.west.consul

nomad job run -address=http://198.19.249.89:4646 -region=east web.hcl

dig @127.0.0.1 -p 8600 web-svc.service.consul
dig @127.0.0.1 -p 8600 web-svc.service.east.consul

nomad job run -address=http://198.19.249.89:4646 -region=west web.hcl

nomad job run -address=http://198.19.249.89:4646 -region=east java-web.hcl
nomad job run -address=http://198.19.249.89:4646 -region=west java-web.hcl

nomad job run -address=http://198.19.249.89:4646 -region=east nginx.hcl
nomad job run -address=http://198.19.249.89:4646 -region=west nginx.hcl

dig @127.0.0.1 -p 8600 nginx.service.consul

curl --request POST --data @payload.json http://127.0.0.1:8500/v1/query

dig @127.0.0.1 -p 8600 nginx.query.consul

//Stop nginx in one region 
dig @127.0.0.1 -p 8600 nginx.query.consul

//Put nginx back up and Stop web-svc in one region 

//Try scaling down and up web-svc and show dynamic updates 

-------KV Magic
Using UI enter a key value for config/web-svc/key
Using UI enter a key value for config/java-web-svc/key

# Reallocate redis and see how jobs fail and then succeed 

-----Secrets, Talk about it 

{{ with secret "database/creds/accessdb" }}
    {
        "host": "$POSTGRES_IP",
        "port": 5432,
        "username": "{{ .Data.username }}",
        "password": {{ .Data.password | toJSON }},
        "db": "postgres"
    }
{{ end }}